-- Banana Blaster Script - Part 1/6
-- Base Setup and UI Library

Players = cloneref(game:GetService("Players"))
RunService = cloneref(game:GetService("RunService"))
ReplicatedStorage = cloneref(game:GetService("ReplicatedStorage"))
UserInputService = cloneref(game:GetService("UserInputService"))

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

local isMobile = UserInputService.TouchEnabled

-- Load WindUI Library
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/454244513/WindUIFix/refs/heads/main/main.lua"))()

local Window = WindUI:CreateWindow({
    Title = "Banana Blaster" .. (isMobile and " ðŸ“±" or ""),
    OpenButton = {
        Title = "Open Menu",
        CornerRadius = UDim.new(0, 12),
        StrokeThickness = 3,
        Color = ColorSequence.new(Color3.fromHex("f9a8d4")),
        OnlyMobile = false,
        Enabled = true,
        Draggable = true,
        Scale = isMobile and 0.7 or 0.5,
    },
})

local MainTab = Window:Tab({Title = "Main"})
MainTab:Select()

local Config = {
    Enabled = false,
    ThrowDistance = 150,
    ThrowPower = 20,
    PredictMovement = true,
    Cooldown = 0.8
}
-- Banana Blaster Script - Part 2/6
-- Main Tab UI

MainTab:Toggle({
    Title = "Blade Aura",
    Callback = function(state)
        Config.Enabled = state
        print("Blade Aura:", state and "ON" or "OFF")
    end
})

MainTab:Slider({
    Title = "Throw Distance",
    Min = 50,
    Max = 250,
    Default = 150,
    Callback = function(value)
        Config.ThrowDistance = value
        print("Distance:", value)
    end
})

MainTab:Slider({
    Title = "Throw Power",
    Min = 10,
    Max = 30,
    Default = 20,
    Callback = function(value)
        Config.ThrowPower = value
        print("Power:", value)
    end
})

MainTab:Toggle({
    Title = "Predict Movement",
    Default = true,
    Callback = function(state)
        Config.PredictMovement = state
        print("Prediction:", state and "ON" or "OFF")
    end
})

MainTab:Button({
    Title = "Test Throw",
    Callback = function()
        executeTestThrow()
    end
})
-- Banana Blaster Script - Part 3/6
-- Game Modules

local success, devv = pcall(function()
    return require(ReplicatedStorage.devv)
end)

if not success then
    warn("Failed to load game modules")
    return
end

local Signal = devv.load("Signal")
local GUID = devv.load("GUID")
local v3item = devv.load("v3item")

local FireServer = Signal.FireServer
local InvokeServer = Signal.InvokeServer
local inventory = v3item.inventory

-- Inventory functions
getinventory = function()
    return inventory and inventory.items or {}
end

finditem = function(string)
    for guid, data in next, getinventory() do
        if data.name == string then
            return data
        end
    end
    return nil
end
-- Banana Blaster Script - Part 4/6
-- Throw Functions

hackthrow = function(plr, itemname, itemguid, velocity, epos)
    if plr ~= LocalPlayer then return end
    
    task.spawn(function()
        local throwGuid = GUID()
        local success, stickyId = pcall(function()
            return InvokeServer("throwSticky", throwGuid, itemname, itemguid, velocity, epos)
        end)
        
        if not success then return end
        
        local dummyPart = Instance.new("Part")
        dummyPart.Size = Vector3.new(2, 2, 2)
        dummyPart.Position = epos
        dummyPart.Anchored = true
        dummyPart.Transparency = 1
        dummyPart.CanCollide = true
        dummyPart.Parent = workspace
        
        local rayParams = RaycastParams.new()
        rayParams.FilterType = Enum.RaycastFilterType.Blacklist
        rayParams.FilterDescendantsInstances = { plr.Character, workspace.Game.Local, workspace.Game.Drones }
        
        local dist = (epos - plr.Character.Head.Position).Magnitude
        local rayResult = workspace:Raycast(
            plr.Character.Head.Position,
            (epos - plr.Character.Head.Position).Unit * (dist + 5),
            rayParams
        )
        
        if rayResult and rayResult.Instance then
            local hitPart = rayResult.Instance
            local relativeHitCFrame = hitPart.CFrame:ToObjectSpace(CFrame.new(rayResult.Position, rayResult.Position + rayResult.Normal))
            local stickyCFrame = CFrame.new(rayResult.Position)
            
            if dummyPart.Parent then dummyPart:Destroy() end
            
            getgenv().throwargs = {
                "hitSticky",
                stickyId or throwGuid,
                hitPart,
                relativeHitCFrame,
                stickyCFrame,
            }
            
            pcall(function()
                InvokeServer("hitSticky", stickyId or throwGuid, hitPart, relativeHitCFrame, stickyCFrame)
            end)
        else
            if dummyPart.Parent then dummyPart:Destroy() end
        end
    end)
end

function GetTargetPosition(targetChar)
    local rootPart = targetChar:FindFirstChild("HumanoidRootPart")
    local torso = targetChar:FindFirstChild("Torso") or targetChar:FindFirstChild("UpperTorso")
    
    if rootPart then
        return rootPart.Position
    elseif torso then
        return torso.Position
    else
        local head = targetChar:FindFirstChild("Head")
        return head and head.Position or targetChar:GetPivot().Position
    end
end

function PredictPosition(targetChar, travelTime)
    local rootPart = targetChar:FindFirstChild("HumanoidRootPart")
    if not rootPart then return GetTargetPosition(targetChar) end
    
    return rootPart.Position + (rootPart.Velocity * travelTime)
end
-- Banana Blaster Script - Part 5/6
-- Target Finding and Throw Logic

function FindBestTarget()
    local bestTarget = nil
    local bestDistance = math.huge
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        
        local char = player.Character
        if not char then continue end
        
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        if not humanoid or humanoid.Health <= 0 then continue end
        
        local targetPos = GetTargetPosition(char)
        local distance = (HumanoidRootPart.Position - targetPos).Magnitude
        
        if distance <= Config.ThrowDistance and distance < bestDistance then
            bestTarget = char
            bestDistance = distance
        end
    end
    
    return bestTarget
end

local LastThrowTime = 0

function ThrowBananaAtTarget(targetChar)
    if tick() - LastThrowTime < Config.Cooldown then return false end
    
    local banana = finditem("Banana Peel")
    if not banana then
        pcall(function()
            InvokeServer("attemptPurchase", "Banana Peel")
        end)
        return false
    end
    
    pcall(function()
        FireServer("equip", banana.guid)
    end)
    
    local targetPos = GetTargetPosition(targetChar)
    local startPos = Character.RightHand.Position
    
    if Config.PredictMovement then
        local distance = (targetPos - startPos).Magnitude
        local travelTime = distance / (Config.ThrowPower * 5)
        targetPos = PredictPosition(targetChar, travelTime)
    end
    
    local distance = (targetPos - startPos).Magnitude
    local direction = (targetPos - startPos).Unit
    local velocity = direction * (distance * Config.ThrowPower)
    
    local success = pcall(function()
        local throwGuid = GUID()
        return InvokeServer("throwSticky", throwGuid, "Banana Peel", banana.guid, velocity, targetPos)
    end)
    
    if success then
        LastThrowTime = tick()
        return true
    end
    
    return false
end

function executeTestThrow()
    local target = FindBestTarget()
    if target then
        ThrowBananaAtTarget(target)
        print("Test throw executed")
    else
        print("No target found for test throw")
    end
end
-- Banana Blaster Script - Part 6/6
-- Main Loop and Event Handlers

-- Main loop
RunService.Heartbeat:Connect(function()
    if not Config.Enabled or not HumanoidRootPart then return end
    
    local target = FindBestTarget()
    if target then
        ThrowBananaAtTarget(target)
    end
end)

-- Manual throw
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F then
        executeTestThrow()
    end
end)

-- Mobile touch
if isMobile then
    UserInputService.TouchStarted:Connect(function(touch, gameProcessed)
        if gameProcessed then return end
        task.spawn(function()
            wait(0.1)
            executeTestThrow()
        end)
    end)
end

-- Character respawn
LocalPlayer.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
end)

print("âœ… Banana Blaster Loaded!")
print("ðŸ“± Mobile:", isMobile and "Yes" or "No")
print("ðŸŽ® Press F to test throw")
print("âš™ï¸ Open menu to configure")
