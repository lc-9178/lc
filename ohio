-- Banana Blaster Script - Part 1/4
-- Mobile Fix + Services and Initialization

-- ä¿®å¤ç§»åŠ¨ç«¯æ»‘å—æ— æ³•æ‹–åŠ¨çš„é—®é¢˜
local old = getrenv().require
getrenv().require = function(a)
    if a == "UserInputService" then
        local uis = old(a)
        local oldInput = uis.InputBegan
        uis.InputBegan = function(self, func)
            -- å¼ºåˆ¶å°†è§¦æ‘¸äº‹ä»¶è½¬æ¢ä¸ºé¼ æ ‡äº‹ä»¶ï¼Œè®©UIåº“èƒ½è¯†åˆ«
            return oldInput(self, function(input, gameProcessed)
                if input.UserInputType == Enum.UserInputType.Touch then
                    input.UserInputType = Enum.UserInputType.MouseButton1
                end
                return func(input, gameProcessed)
            end)
        end
        return uis
    end
    return old(a)
end

Players = cloneref(game:GetService("Players"))
RunService = cloneref(game:GetService("RunService"))
ReplicatedStorage = cloneref(game:GetService("ReplicatedStorage"))
UserInputService = cloneref(game:GetService("UserInputService"))
LocalPlayer = Players.LocalPlayer

-- Check if mobile
local isMobile = UserInputService.TouchEnabled and not UserInputService.MouseEnabled

-- Character Setup
local Character = LocalPlayer.Character
local Humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
local HumanoidRootPart = Character and Character:FindFirstChild("HumanoidRootPart")

LocalPlayer.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    Humanoid = char:WaitForChild("Humanoid")
end)

-- Load WindUI with mobile fix
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/454244513/WindUIFix/refs/heads/main/main.lua"))()
local Window = WindUI:CreateWindow({
    Title = "Banana Blaster" .. (isMobile and " ðŸ“±" or " ðŸ–¥ï¸"),
    OpenButton = {
        Title = "Open Menu",
        CornerRadius = UDim.new(0, 16),
        StrokeThickness = 3,
        Color = ColorSequence.new(Color3.fromHex("f9a8d4")),
        OnlyMobile = false,
        Enabled = true,
        Draggable = true,
        Scale = isMobile and 0.8 or 0.5,
    },
})

local MainTab = Window:Tab({Title = "Main"})
MainTab:Select()

-- Configuration
local bladeaura = false
local throwDistance = 190
local throwPower = 15
local predictMovement = true
local mobileSensitivity = 1.0
local mobileAutoAim = true
-- Banana Blaster Script - Part 2/4
-- UI Elements with Mobile Support

-- Main Controls
MainTab:Toggle({
    Title = "Blade Aura",
    Callback = function(state)
        bladeaura = state
        print("Blade Aura:", state and "ON" or "OFF")
    end,
})

MainTab:Slider({
    Title = "Throw Distance",
    Min = 50,
    Max = 250,
    Default = 190,
    Callback = function(value)
        throwDistance = value
        print("Throw Distance:", value)
    end,
})

MainTab:Slider({
    Title = "Throw Power",
    Min = 10,
    Max = 25,
    Default = 15,
    Callback = function(value)
        throwPower = value
        print("Throw Power:", value)
    end,
})

MainTab:Toggle({
    Title = "Predict Movement",
    Default = true,
    Callback = function(state)
        predictMovement = state
        print("Movement Prediction:", state and "ON" or "OFF")
    end,
})

-- Mobile-specific controls
if isMobile then
    MainTab:Label({Title = "ðŸ“± Mobile Settings", Color = Color3.fromRGB(100, 200, 255)})
    
    MainTab:Slider({
        Title = "Touch Sensitivity",
        Min = 0.1,
        Max = 2.0,
        Default = 1.0,
        Callback = function(value)
            mobileSensitivity = value
            print("Touch Sensitivity:", value)
        end,
    })
    
    MainTab:Toggle({
        Title = "Auto Aim Assist",
        Default = true,
        Callback = function(state)
            mobileAutoAim = state
            print("Auto Aim Assist:", state and "ON" or "OFF")
        end,
    })
    
    MainTab:Button({
        Title = "Quick Throw (Tap Screen)",
        Callback = function()
            print("Tap anywhere on screen to throw banana")
        end,
    })
end

-- Mobile Tab
local MobileTab = Window:Tab({Title = "Mobile ðŸ“±"})

if isMobile then
    MobileTab:Label({Title = "Mobile Controls", Color = Color3.fromRGB(255, 200, 100)})
    
    MobileTab:Toggle({
        Title = "Enable Touch Controls",
        Default = true,
        Callback = function(state)
            print("Touch Controls:", state and "ENABLED" or "DISABLED")
        end,
    })
    
    MobileTab:Slider({
        Title = "Aim Assist Strength",
        Min = 0,
        Max = 100,
        Default = 75,
        Callback = function(value)
            print("Aim Assist Strength:", value .. "%")
        end,
    })
    
    MobileTab:Dropdown({
        Title = "Throw Mode",
        Items = {"Auto Target", "Manual Aim", "Smart Hybrid"},
        Callback = function(selected)
            print("Throw Mode:", selected)
        end,
    })
    
    MobileTab:Keybind({
        Title = "Quick Throw Key",
        Default = Enum.KeyCode.T,
        Callback = function()
            executeManualThrow()
        end,
    })
else
    MobileTab:Label({Title = "Mobile features not available", Color = Color3.fromRGB(255, 100, 100)})
    MobileTab:Label({Title = "Play on mobile device to access these settings"})
end
-- Banana Blaster Script - Part 3/4
-- Mobile Functions

-- Mobile touch controls
local touchStartTime = 0
local touchStartPosition = Vector2.new(0, 0)
local isTouching = false

-- Enhanced mobile aim function
function calculateMobileAim(targetPosition, startPosition)
    if not mobileAutoAim then
        return targetPosition
    end
    
    local direction = (targetPosition - startPosition).Unit
    local distance = (targetPosition - startPosition).Magnitude
    
    -- Apply aim assist
    if mobileAutoAim then
        local assistStrength = mobileSensitivity * 0.3
        local closestTarget = findClosestTarget(startPosition, distance * 1.5)
        
        if closestTarget then
            local targetDir = (closestTarget - startPosition).Unit
            direction = (direction + targetDir * assistStrength).Unit
        end
    end
    
    return startPosition + direction * distance
end

function findClosestTarget(fromPosition, maxDistance)
    local closestTarget = nil
    local closestDistance = math.huge
    
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr == LocalPlayer then continue end
        
        local char = plr.Character
        if not char then continue end
        
        local hum = char:FindFirstChildOfClass("Humanoid")
        local humanoidRootPart = char:FindFirstChild("HumanoidRootPart")
        
        if hum and hum.Health > 0 and humanoidRootPart then
            local dist = (fromPosition - humanoidRootPart.Position).Magnitude
            if dist < maxDistance and dist < closestDistance then
                closestDistance = dist
                closestTarget = humanoidRootPart.Position
            end
        end
    end
    
    return closestTarget
end

-- Mobile touch input handling
if isMobile then
    UserInputService.TouchStarted:Connect(function(touch, gameProcessed)
        if gameProcessed then return end
        
        isTouching = true
        touchStartTime = tick()
        touchStartPosition = touch.Position
        
        -- Quick throw on tap
        task.spawn(function()
            wait(0.1) -- Wait to see if it's a tap or drag
            if isTouching then
                local currentTime = tick()
                if currentTime - touchStartTime < 0.3 then -- It's a tap
                    executeManualThrow()
                end
            end
        end)
    end)
    
    UserInputService.TouchEnded:Connect(function(touch, gameProcessed)
        if gameProcessed then return end
        
        isTouching = false
        local touchEndTime = tick()
        local touchDuration = touchEndTime - touchStartTime
        
        -- Swipe throw (drag and release)
        if touchDuration > 0.3 then
            local endPosition = touch.Position
            local swipeVector = endPosition - touchStartPosition
            local swipeMagnitude = swipeVector.Magnitude
            
            if swipeMagnitude > 50 then -- Minimum swipe distance
                executeSwipeThrow(swipeVector, swipeMagnitude)
            end
        end
    end)
end

function executeManualThrow()
    local closestTarget = findClosestTarget(HumanoidRootPart.Position, throwDistance)
    if closestTarget then
        local targetChar = getCharacterFromPosition(closestTarget)
        if targetChar then
            executebladekill(nil, targetChar)
        end
    else
        print("No target found in range")
    end
end

function executeSwipeThrow(swipeVector, swipeMagnitude)
    if not HumanoidRootPart then return end
    
    local powerMultiplier = math.min(swipeMagnitude / 200, 2.0) * mobileSensitivity
    local direction = Vector3.new(swipeVector.X, 50, swipeVector.Y).Unit
    
    local startPos = HumanoidRootPart.Position + Vector3.new(0, 2, 0)
    local targetPos = startPos + direction * throwDistance * powerMultiplier
    
    -- Apply mobile aim assist
    targetPos = calculateMobileAim(targetPos, startPos)
    
    local item = finditem("Banana Peel")
    if item then
        FireServer("equip", item.guid)
        local velocity = (targetPos - startPos).Unit * throwPower * powerMultiplier
        hackthrow(LocalPlayer, "Banana Peel", item.guid, velocity, targetPos)
    end
end

function getCharacterFromPosition(position)
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr == LocalPlayer then continue end
        
        local char = plr.Character
        if char then
            local humanoidRootPart = char:FindFirstChild("HumanoidRootPart")
            if humanoidRootPart and (humanoidRootPart.Position - position).Magnitude < 10 then
                return char
            end
        end
    end
    return nil
end
-- Banana Blaster Script - Part 4/4
-- Core Functions

-- Game Modules
load = require(ReplicatedStorage.devv).load
Signal = load("Signal")
FireServer = Signal.FireServer
InvokeServer = Signal.InvokeServer
GUID = load("GUID")
v3item = load("v3item")
Raycast = load("Raycast")
local inventory = v3item.inventory

-- Throw Function
hackthrow = function(plr, itemname, itemguid, velocity, epos)
    if plr ~= LocalPlayer then return end
    
    task.spawn(function()
        local throwGuid = GUID()
        local success, stickyId = pcall(function()
            return InvokeServer("throwSticky", throwGuid, itemname, itemguid, velocity, epos)
        end)
        
        if not success then return end
        
        local dummyPart = Instance.new("Part")
        dummyPart.Size = Vector3.new(2, 2, 2)
        dummyPart.Position = epos
        dummyPart.Anchored = true
        dummyPart.Transparency = 1
        dummyPart.CanCollide = true
        dummyPart.Parent = workspace
        
        local rayParams = RaycastParams.new()
        rayParams.FilterType = Enum.RaycastFilterType.Blacklist
        rayParams.FilterDescendantsInstances = { plr.Character, workspace.Game.Local, workspace.Game.Drones }
        
        local dist = (epos - plr.Character.Head.Position).Magnitude
        local rayResult = workspace:Raycast(
            plr.Character.Head.Position,
            (epos - plr.Character.Head.Position).Unit * (dist + 5),
            rayParams
        )
        
        if rayResult and rayResult.Instance then
            local hitPart = rayResult.Instance
            local relativeHitCFrame = hitPart.CFrame:ToObjectSpace(CFrame.new(rayResult.Position, rayResult.Position + rayResult.Normal))
            local stickyCFrame = CFrame.new(rayResult.Position)
            
            if dummyPart.Parent then dummyPart:Destroy() end
            
            getgenv().throwargs = {
                "hitSticky",
                stickyId or throwGuid,
                hitPart,
                relativeHitCFrame,
                stickyCFrame,
            }
            
            pcall(function()
                InvokeServer("hitSticky", stickyId or throwGuid, hitPart, relativeHitCFrame, stickyCFrame)
            end)
        else
            if dummyPart.Parent then dummyPart:Destroy() end
        end
    end)
end

-- Inventory Functions
getinventory = function()
    return inventory and inventory.items or {}
end

finditem = function(string)
    for guid, data in next, getinventory() do
        if data.name == string or data.type == string or data.subtype == string then
            return data
        end
    end
    return nil
end

-- Main Throw Logic
executebladekill = function(plr, targetChar)
    local item = finditem("Banana Peel")
    if not item then
        pcall(function()
            InvokeServer("attemptPurchase", "Banana Peel")
        end)
        return
    end

    pcall(function()
        FireServer("equip", item.guid)
    end)

    local head = targetChar:FindFirstChild("Head")
    local humanoidRootPart = targetChar:FindFirstChild("HumanoidRootPart")
    
    if not head and not humanoidRootPart then return end

    local targetPart = humanoidRootPart or head
    local spos = LocalPlayer.Character.RightHand.Position
    local epos = targetPart.Position

    -- Enhanced movement prediction for mobile
    if predictMovement and humanoidRootPart then
        local distance = (epos - spos).Magnitude
        local travelTime = distance / (throwPower * 5)
        local velocity = humanoidRootPart.Velocity
        
        -- Mobile-specific prediction adjustment
        if isMobile then
            travelTime = travelTime * mobileSensitivity
        end
        
        epos = epos + (velocity * travelTime)
    end

    local velocity = (epos - spos).Unit * ((spos - epos).Magnitude * throwPower)
    
    pcall(function()
        InvokeServer("attemptPurchaseAmmo", "Banana Peel")
    end)
    
    hackthrow(LocalPlayer, "Banana Peel", item.guid, velocity, epos)

    if getgenv().throwargs then
        getgenv().throwargs[3] = targetPart
        pcall(function()
            InvokeServer(unpack(getgenv().throwargs))
        end)
    end
end

-- Main Loop
local lastThrowTime = 0
local throwCooldown = 0.5

RunService.Heartbeat:Connect(function()
    if not bladeaura or not HumanoidRootPart then return end
    
    local currentTime = tick()
    if currentTime - lastThrowTime < throwCooldown then return end
    
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr == LocalPlayer then continue end
        
        local char = plr.Character
        if not char then continue end
        
        local hum = char:FindFirstChildOfClass("Humanoid")
        local head = char:FindFirstChild("Head")
        local humanoidRootPart = char:FindFirstChild("HumanoidRootPart")
        
        if not hum or hum.Health <= 0 then continue end
        
        local targetPart = humanoidRootPart or head
        if not targetPart then continue end
        
        local dist = (HumanoidRootPart.Position - targetPart.Position).Magnitude
        if dist < throwDistance then
            executebladekill(plr, char)
            lastThrowTime = currentTime
            break
        end
    end
end)

-- Manual Throw (PC)
if not isMobile then
    UserInputService.InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.F then
            local closestTarget = findClosestTarget(HumanoidRootPart.Position, throwDistance)
            if closestTarget then
                local targetChar = getCharacterFromPosition(closestTarget)
                if targetChar then
                    executebladekill(nil, targetChar)
                end
            end
        end
    end)
end

print("ðŸŒ Banana Blaster Script Loaded Successfully!")
print("ðŸ“± Mobile Mode:", isMobile and "ENABLED" or "DISABLED")
if isMobile then
    print("âœ… Mobile Fix: Sliders should work now")
    print("ðŸ‘† Mobile Controls: Tap screen to throw")
    print("ðŸ“ Swipe Controls: Drag and release to aim")
else
    print("ðŸŽ® PC Controls: Press F to throw")
end
print("âš™ï¸ Settings: Open UI menu to adjust")
