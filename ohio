-- ===== 1. 初始化 =====
local Players = cloneref(game:GetService("Players"))
local RunService = cloneref(game:GetService("RunService"))
local ReplicatedStorage = cloneref(game:GetService("ReplicatedStorage"))
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character
local Humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
local HumanoidRootPart = Character and Character:FindFirstChild("HumanoidRootPart")

LocalPlayer.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    Humanoid = char:WaitForChild("Humanoid")
end)-- ===== 2. UI界面 =====
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/454244513/WindUIFix/refs/heads/main/main.lua"))()
local Window = WindUI:CreateWindow({
    Title = "香蕉追踪",
    OpenButton = {
        Title = "香蕉",
        CornerRadius = UDim.new(0, 16),
        StrokeThickness = 3,
        Color = ColorSequence.new(Color3.fromHex("f9a8d4"), Color3.fromHex("f9a8d4")),
        OnlyMobile = true,
        Enabled = true,
        Draggable = true,
        Scale = 0.6,
    },
})

local Tab = Window:Tab({ Title = "Banana Track" })
Tab:Select()

local BananaAura = false
local ThrowDelay = 0.8

Tab:Toggle({
    Title = "Banana Stick Aura",
    Callback = function(state)
        BananaAura = state
        bladeaura = state
    end,
})

Tab:Slider({
    Title = "Throw Delay",
    Min = 0.3,
    Max = 2.0,
    Default = 0.8,
    Increase = 0.1,
    Callback = function(value)
        ThrowDelay = value
    end,
})-- ===== 3. 远程加载 =====
local load = require(ReplicatedStorage.devv).load
local Signal = load("Signal")
local FireServer = Signal.FireServer
local InvokeServer = Signal.InvokeServer
local GUID = load("GUID")
local v3item = load("v3item")
local Raycast = load("Raycast")
local inventory = v3item.inventory

local getinventory = function()
    return inventory.items
end

local finditem = function(string)
    for guid, data in next, getinventory() do
        if data.name == string or data.type == string or data.subtype == string then
            return data
        end
    end
end-- ===== 4. 直接放置香蕉到敌人身体 =====
local function stickBananaToPlayer(plr)
    if plr == LocalPlayer then return end
    if not plr.Character then return end
    
    local item = finditem("Banana Peel")
    if not item then
        task.spawn(InvokeServer, "attemptPurchase", "Banana Peel")
        return
    end
    
    -- 装备香蕉
    FireServer("equip", item.guid)
    
    -- 获取敌人身体部位
    local targetChar = plr.Character
    local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
    local targetHead = targetChar:FindFirstChild("Head")
    local targetTorso = targetChar:FindFirstChild("UpperTorso") or targetChar:FindFirstChild("Torso")
    
    if not targetRoot then return end
    
    -- 随机选择粘贴位置：身体中心、头、胸
    local attachPart = targetRoot
    if targetHead and math.random(1, 3) == 1 then
        attachPart = targetHead
    elseif targetTorso and math.random(1, 2) == 1 then
        attachPart = targetTorso
    end
    
    -- 直接调用粘性香蕉远程事件，不经过投掷
    local stickGuid = GUID()
    
    -- 构建粘贴参数
    local hitPart = attachPart
    local relativeCFrame = hitPart.CFrame:ToObjectSpace(CFrame.new(hitPart.Position))
    local stickyCFrame = CFrame.new(hitPart.Position)
    
    -- 直接粘贴到敌人身体
    pcall(function()
        InvokeServer("hitSticky", stickGuid, hitPart, relativeCFrame, stickyCFrame)
    end)
    
    -- 移除香蕉皮物品（使用后消耗）
    task.spawn(function()
        task.wait(0.1)
        pcall(function()
            FireServer("removeItem", item.guid)
        end)
    end)
end-- ===== 5. 购买系统 =====
local function buyBanana()
    if not finditem("Banana Peel") then
        task.spawn(InvokeServer, "attemptPurchase", "Banana Peel")
    end
end

-- 不需要弹药，直接放置-- ===== 6. 攻击多个玩家 - 直接放置香蕉到身体 =====
local targetList = {}
local lastStickTimes = {}

local function stickBanana(plr)
    if plr == LocalPlayer then return end
    if not plr.Character then return end
    
    local item = finditem("Banana Peel")
    if item then
        FireServer("equip", item.guid)
        
        local targetChar = plr.Character
        local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
        if not targetRoot then return end
        
        -- 直接粘贴到敌人身体中心
        local stickGuid = GUID()
        local hitPart = targetRoot
        local relativeCFrame = hitPart.CFrame:ToObjectSpace(CFrame.new(hitPart.Position))
        local stickyCFrame = CFrame.new(hitPart.Position)
        
        pcall(function()
            InvokeServer("hitSticky", stickGuid, hitPart, relativeCFrame, stickyCFrame)
        end)
        
        -- 消耗香蕉皮
        task.spawn(function()
            task.wait(0.1)
            pcall(function()
                FireServer("removeItem", item.guid)
            end)
        end)
    else
        buyBanana()
    end
end-- ===== 7. 主循环 - 给所有敌人身上贴香蕉 =====
RunService.Heartbeat:Connect(function()
    if BananaAura and HumanoidRootPart and LocalPlayer.Character then
        
        -- 更新目标列表
        targetList = {}
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer and plr.Character then
                local hum = plr.Character:FindFirstChildOfClass("Humanoid")
                local head = plr.Character:FindFirstChild("Head")
                
                if hum and hum.Health > 0 and head then
                    local dist = (HumanoidRootPart.Position - head.Position).Magnitude
                    if dist < 190 then
                        table.insert(targetList, plr)
                    end
                end
            end
        end
        
        -- 给所有在范围内的敌人身上贴香蕉
        for _, plr in ipairs(targetList) do
            if not lastStickTimes[plr] then
                lastStickTimes[plr] = 0
            end
            
            if tick() - lastStickTimes[plr] >= ThrowDelay then
                stickBanana(plr)
                lastStickTimes[plr] = tick()
            end
        end
    end
end)-- ===== 8. 清理死亡玩家 =====
task.spawn(function()
    while task.wait(1) do
        for plr, _ in pairs(lastStickTimes) do
            if not plr or not plr.Character or not plr.Character:FindFirstChildOfClass("Humanoid") or 
               plr.Character.Humanoid.Health <= 0 then
                lastStickTimes[plr] = nil
            end
        end
    end
end)-- ===== 9. 自动购买香蕉皮 =====
task.spawn(function()
    while task.wait(2.0) do
        if BananaAura then
            pcall(function()
                if not finditem("Banana Peel") then
                    InvokeServer("attemptPurchase", "Banana Peel")
                end
            end)
        end
    end
end)